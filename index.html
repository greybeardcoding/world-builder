<!DOCTYPE html>
<html>
<head>
    <title>World Builder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Left Panel -->
        <div class="panel left-panel">
            <div class="panel-header">Workspace</div>
            <div class="block-container" id="left-blocks">
                <div class="block">
                    <div class="block-type">account</div>
                    <div class="block-content">
                        <strong>User Account</strong><br>
                        <small>john.doe@example.com</small>
                    </div>
                </div>
                <div class="block">
                    <div class="block-type">menu</div>
                    <div class="block-content">
                        <div>üìÑ New Document</div>
                        <div>üìÅ Open Folder</div>
                        <div>‚öôÔ∏è Settings</div>
                    </div>
                </div>
                <div class="block">
                    <div class="block-type">tree</div>
                    <div class="block-content">
                        <div><strong>üìÅ Project Files</strong></div>
                        <div style="margin-left: 16px;">üìÑ Chapter 1.md</div>
                        <div style="margin-left: 16px;">üìÑ Chapter 2.md</div>
                        <div style="margin-left: 16px;">üìÅ Characters</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Middle Panel -->
        <div class="panel middle-panel">
            <div class="tab-container">
                <button class="tab active" onclick="App.switchTab(0)">Document 1</button>
                <button class="tab" onclick="App.switchTab(1)">Document 2</button>
            </div>
            <div class="tab-content">
                <div class="block-container" id="middle-blocks">
                    <!-- Blocks will be dynamically added here -->
                </div>
                <button class="add-block-btn" onclick="App.addNewBlock()">+ Add Block</button>
            </div>
        </div>
        
        <!-- Right Panel -->
        <div class="panel right-panel">
            <div class="panel-header">Properties</div>
            <div class="block-container" id="right-blocks">
                <div class="block">
                    <div class="block-type">meta</div>
                    <div class="block-content">
                        <strong>Document Info</strong><br>
                        <small>Created: Today<br>
                        Words: 1,247<br>
                        Status: Draft</small>
                    </div>
                </div>
                <div class="block">
                    <div class="block-type">outline</div>
                    <div class="block-content">
                        <strong>Document Outline</strong>
                        <div style="margin-top: 8px;">
                            <div>1. Introduction</div>
                            <div>2. Main Content</div>
                            <div>3. Conclusion</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script type="module">
        import { Editor } from './node_modules/@tiptap/core/dist/index.js'
        import StarterKit from './node_modules/@tiptap/starter-kit/dist/index.js'
        import Placeholder from './node_modules/@tiptap/extension-placeholder/dist/index.js'

        // SOLID: Single responsibility block system
        class BlockSystem {
            constructor() {
                this.blocks = [];
                this.editors = new Map();
                this.container = document.getElementById('middle-blocks');
            }

            // ATOMIC: Create single block
            createBlock(type = 'text') {
                const blockId = `block-${Date.now()}-${Math.random().toString(36).slice(2, 11)}`;
                
                const blockElement = document.createElement('div');
                blockElement.className = 'block';
                blockElement.innerHTML = `
                    <div class="block-actions">
                        <button onclick="App.removeBlock('${blockId}')">√ó</button>
                    </div>
                    <div class="block-type">${type}</div>
                    <div class="block-content">
                        <div class="block-editor" id="${blockId}"></div>
                    </div>
                `;

                this.container.appendChild(blockElement);

                // Don't Reinvent: Use Tiptap's proven editor
                const editor = new Editor({
                    element: document.getElementById(blockId),
                    extensions: [
                        StarterKit,
                        Placeholder.configure({
                            placeholder: `Start typing in this ${type} block...`
                        })
                    ],
                    content: '',
                    editorProps: {
                        attributes: {
                            class: 'ProseMirror'
                        }
                    }
                });

                const block = { id: blockId, type, element: blockElement, editor };
                this.blocks.push(block);
                this.editors.set(blockId, editor);

                // Focus new block
                setTimeout(() => editor.commands.focus(), 100);
                
                return block;
            }

            // YAGNI: Simple removal
            removeBlock(blockId) {
                const editor = this.editors.get(blockId);
                if (editor) {
                    editor.destroy();
                    this.editors.delete(blockId);
                }

                this.blocks = this.blocks.filter(block => {
                    if (block.id === blockId) {
                        block.element.remove();
                        return false;
                    }
                    return true;
                });
            }
        }

        // Namespace all app functionality under single global
        window.App = {
            blockSystem: new BlockSystem(),
            
            // UI Functions
            addNewBlock() {
                return this.blockSystem.createBlock('text');
            },
            
            switchTab(index) {
                const tabs = document.querySelectorAll('.tab');
                tabs.forEach((tab, i) => {
                    tab.classList.toggle('active', i === index);
                });
            },
            
            removeBlock(blockId) {
                return this.blockSystem.removeBlock(blockId);
            }
        };

        // Add initial block
        window.App.blockSystem.createBlock('text');
    </script>
</body>
</html>